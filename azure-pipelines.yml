# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

pool:
  vmImage: windows-latest

variables:
  MSBuildBinPath: 'C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\'

steps:
- task: PowerShell@2
  env:
    MSBuildBinPath: ${{ variables.MSBuildBinPath }}
  inputs:
    filePath: 'backend\src\Database\Command\Scripts\build\BuildCsproj.ps1'
    workingDirectory: 'backend\src\Database\Command\Scripts\build'
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    useGlobalJson: true
    workingDirectory: 'backend\src'
- task: DotNetCoreCLI@2
  inputs:
    command: 'custom'
    custom: 'tool'
    arguments: 'install --global dotnet-ef'
- task: PowerShell@2
  inputs:
    filePath: 'backend\src\Database\Command\Scripts\build\Add-EventOutboxAdapterScripts.ps1'
    workingDirectory: 'backend\src\Database\Command\Scripts\build'
- task: PowerShell@2
  inputs:
    filePath: 'backend\src\Database\Command\Scripts\build\Add-SagaNotificationsScripts.ps1'
    workingDirectory: 'backend\src\Database\Command\Scripts\build'
- task: PowerShell@2
  inputs:
    filePath: 'backend\src\Database\Command\Scripts\build\CopyArtifacts.ps1'
    arguments: '$(Build.ArtifactStagingDirectory)'
    workingDirectory: 'backend\src\Database\Command\Scripts\build'